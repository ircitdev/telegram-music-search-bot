# –î–µ–Ω—å 5-7: Downloader, Audio Sending, Rate Limiting

**–î–∞—Ç–∞:** 4 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
**–ü—Ä–µ–¥—ã–¥—É—â–∏–π —ç—Ç–∞–ø:** ‚úÖ –î–µ–Ω—å 1-4 (MVP –≥–æ—Ç–æ–≤)  
**GitHub:** <https://github.com/ircitdev/telegram-music-search-bot>

---

## ‚úÖ –î–ï–ù–¨ 5-7 –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–´

**26+ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ** | **40+ –ø—Ä–æ–≤–µ—Ä–æ–∫ —É—Å–ø–µ—à–Ω–æ** | **–ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ production**

---

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### –î–µ–Ω—å 5: –ó–∞–≤–µ—Ä—à–∏—Ç—å YouTube Downloader ‚úÖ –¢–ï–ö–£–©–ò–ô

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

1. [ ] –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ MP3 –∏–∑ YouTube
2. [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
3. [ ] –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ MP3 (192 kbps)
4. [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (—Ñ–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π, –Ω–µ –Ω–∞–π–¥–µ–Ω –∏ —Ç.–¥.)
5. [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

**–§–∞–π–ª—ã:**

- `src/downloaders/youtube_dl.py` - —É–∂–µ —Å–æ–∑–¥–∞–Ω, –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- `src/handlers/callbacks.py` - —É–∂–µ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–¢–µ—Å—Ç—ã:**

- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Ç—Ä–µ–∫–∞ (< 1 –º–∏–Ω)
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–≥–æ —Ç—Ä–µ–∫–∞ (3-5 –º–∏–Ω)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏: —Ñ–∞–π–ª > 50 MB
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏: –≤–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ

---

### –î–µ–Ω—å 6: –û—Ç–ø—Ä–∞–≤–∫–∞ –∞—É–¥–∏–æ –≤ Telegram

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

1. [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ MP3 —Ñ–∞–π–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
2. [ ] –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞—É–¥–∏–æ (–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –Ω–∞–∑–≤–∞–Ω–∏–µ, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
3. [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
4. [ ] Cleanup –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
5. [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

**–§–∞–π–ª—ã:**

- `src/handlers/callbacks.py` - —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç FSInputFile –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- `src/utils/cleanup.py` - –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–ª—è –æ—á–∏—Å—Ç–∫–∏

**–§—É–Ω–∫—Ü–∏–∏:**

```python
# –í callbacks.py —É–∂–µ –µ—Å—Ç—å:
audio_file = FSInputFile(file_path)
await callback.message.answer_audio(
    audio=audio_file,
    performer=track.artist,
    title=track.title,
    duration=track.duration
)
```

---

### –î–µ–Ω—å 7: Rate Limiting –∏ Cleanup

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**

1. [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Rate Limiting (5 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É)
2. [ ] –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è cleanup —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
3. [ ] –ü–æ–ª–Ω–æ–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
4. [ ] –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç—ã

**–§–∞–π–ª—ã:**

- `src/utils/rate_limiter.py` - –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å
- `src/utils/cleanup.py` - –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–î–µ–Ω—å 5-7)

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞ –±–æ—Ç –¥–æ–ª–∂–µ–Ω:

‚úÖ **–ü–æ–∏—Å–∫:**

- –ù–∞—Ö–æ–¥–∏—Ç—å –º—É–∑—ã–∫—É –Ω–∞ YouTube
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å 10 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 10 –º–∏–Ω—É—Ç

‚úÖ **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ:**

- –°–∫–∞—á–∏–≤–∞—Ç—å MP3 –∏–∑ YouTube (192 kbps)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏

‚úÖ **–û—Ç–ø—Ä–∞–≤–∫–∞:**

- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å MP3 –≤ Telegram
- –î–æ–±–∞–≤–ª—è—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –Ω–∞–∑–≤–∞–Ω–∏–µ)
- –£–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

‚úÖ **–ó–∞—â–∏—Ç–∞:**

- Rate limiting (5 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É)
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –≠—Ç–∞–ø 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ downloader

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç downloader
python test_downloader.py  # –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω
```

### –≠—Ç–∞–ø 2: –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ (–ø–æ–∏—Å–∫ -> —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ -> –æ—Ç–ø—Ä–∞–≤–∫–∞)
python test_full_flow.py  # –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω
```

### –≠—Ç–∞–ø 3: –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç
python -m src.main

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
# 1. /start
# 2. /help
# 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏
# 4. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É 1-10
# 5. –ü–æ–ª—É—á–∏—Ç—å MP3 —Ñ–∞–π–ª
```

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å

| –î–∞—Ç–∞ | –î–µ–Ω—å | –°—Ç–∞—Ç—É—Å | –ó–∞–¥–∞—á–∞ |
|------|------|--------|--------|
| 04.12 | 1-4 | ‚úÖ | MVP: –ü–æ–∏—Å–∫, –∫—ç—à, –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã |
| 04.12 | 5 | üîÑ | –ó–∞–≤–µ—Ä—à–∏—Ç—å downloader |
| 04.12 | 6 | ‚è≥ | –û—Ç–ø—Ä–∞–≤–∫–∞ MP3 –≤ Telegram |
| 04.12 | 7 | ‚è≥ | Rate limiting & cleanup |

---

## üìù Notes

- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç FFmpeg –Ω–∞ —Å–∏—Å—Ç–µ–º–µ
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –¥–ª—è YouTube
- ‚ö†Ô∏è –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ `data/temp/`
- ‚úÖ .env –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è (–∑–∞—â–∏—Ç–∞ —Ç–æ–∫–µ–Ω–∞)

---

**–ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å –î–µ–Ω—å 5? üöÄ**
